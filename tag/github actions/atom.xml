<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://blog.udon.eu.org</id>
    <title>カレーうどん屋 • Posts by &#34;github actions&#34; tag</title>
    <link href="https://blog.udon.eu.org" />
    <updated>2022-05-23T11:30:00.000Z</updated>
    <category term="教程" />
    <category term="随笔" />
    <category term="软件" />
    <category term="小鸡测评" />
    <category term="3D 打印" />
    <category term="嵌入式开发" />
    <category term="GitHub Actions" />
    <category term="Hexo" />
    <category term="DIY" />
    <entry>
        <id>https://blog.udon.eu.org/archives/2e528779.html</id>
        <title>迁移 Hexo 渲染环境至 GitHub Actions</title>
        <link rel="alternate" href="https://blog.udon.eu.org/archives/2e528779.html"/>
        <content type="html">&lt;link rel=&#34;stylesheet&#34; class=&#34;aplayer-secondary-style-marker&#34; href=&#34;/assets/css/APlayer.min.css&#34;&gt;&lt;script src=&#34;/assets/js/APlayer.min.js&#34; class=&#34;aplayer-secondary-script-marker&#34;&gt;&lt;/script&gt;&lt;script class=&#34;meting-secondary-script-marker&#34; src=&#34;/assets/js/Meting.min.js&#34;&gt;&lt;/script&gt;&lt;p&gt;本博客使用的是 Hexo 静态博客框架，我将渲染环境搭建在家中 NAS 之上，部署了一个 Ubuntu Docker 并安装好了 Node.js 环境，正常使用了一两年。&lt;/p&gt;
&lt;p&gt;上周末，写完新文章的我心血来潮，打算在更新博客的时候顺便更新一下老旧的 Node 和 Hexo（Node 12, Hexo 5.2）。&lt;/p&gt;
&lt;p&gt;一番折腾之后，以 npm 和 hexo 环境全部被破坏（事后想想也许只是环境变量掉了）的下场结束。&lt;/p&gt;
&lt;p&gt;鉴于 NAS 性能低下，更新一次 node module 都需要 30 分钟，我放弃了在 NAS 上重新部署渲染环境的念头，转而使用 GitHub Actions 渲染，并同时部署于 GitHub Pages 与 CloudFlare Pages。&lt;/p&gt;
&lt;h2 id=&#34;将渲染环境迁至-GitHub-Actions&#34;&gt;&lt;a href=&#34;#将渲染环境迁至-GitHub-Actions&#34; class=&#34;headerlink&#34; title=&#34;将渲染环境迁至 GitHub Actions&#34;&gt;&lt;/a&gt;将渲染环境迁至 GitHub Actions&lt;/h2&gt;&lt;p&gt;不久之前，CloudFlare Pages 悄悄下架了 Hexo 框架的部署功能，只能用 GitHub Actions 渲染，然后再部署至 CloudFlare Pages 了。&lt;/p&gt;
&lt;h3 id=&#34;项目结构的修改&#34;&gt;&lt;a href=&#34;#项目结构的修改&#34; class=&#34;headerlink&#34; title=&#34;项目结构的修改&#34;&gt;&lt;/a&gt;项目结构的修改&lt;/h3&gt;&lt;p&gt;若想使用 GitHub Actions，需要将博客的源码上传至 GitHub。考虑到隐私和安全的问题，建议创建一个私有仓库管理源码。&lt;/p&gt;
&lt;p&gt;对于项目没有什么需要修改的，因为 Actions 渲染的流程和本地渲染的流程没有区别。&lt;/p&gt;
&lt;p&gt;唯一需要改动的，是引入的主题。由于两个 Git 仓库不能嵌套，我们需要以 Git submodule 的形式引入主题仓库。&lt;/p&gt;
&lt;p&gt;我使用的是 Fluid 主题。采用 &lt;a href=&#34;https://hexo.fluid-dev.com/docs/guide/#%E8%A6%86%E7%9B%96%E9%85%8D%E7%BD%AE&#34;&gt;覆盖配置&lt;/a&gt; 的方法，即在根目录之下有一份配置会覆盖主题内的配置文件，便于在 Actions 中渲染。&lt;/p&gt;
&lt;p&gt;以下也将以 Fluid 为例，请根据你使用的主题修改命令或代码。&lt;/p&gt;
&lt;p&gt;首先，删除原来的主题（若使用的是主题内的配置，注意备份配置文件！）&lt;/p&gt;
&lt;p&gt;返回博客源码的根目录，执行：&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;git submodule add https://github.com/fluid-dev/hexo-theme-fluid.git themes/fluid&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;末尾的 &lt;code&gt;themes/fluid&lt;/code&gt; 为此 submodule 在项目中的位置与名字，与先前本地渲染时的配置相同即可。&lt;/p&gt;
&lt;p&gt;删除子模块的过程较为繁琐，请参考网上的文章进行操作。&lt;/p&gt;
&lt;p&gt;在 Clone 此项目时，submodule 默认不会被下载，需要使用指令：&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;git submodule update --init --recursive&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;下载 submodule。在下面会提到的 Actions 配置文件中会出现这条指令。&lt;/p&gt;
&lt;p&gt;接着，就可以将博客源码上传至 GitHub。&lt;/p&gt;
&lt;h3 id=&#34;GitHub-Actions-相关文件&#34;&gt;&lt;a href=&#34;#GitHub-Actions-相关文件&#34; class=&#34;headerlink&#34; title=&#34;GitHub Actions 相关文件&#34;&gt;&lt;/a&gt;GitHub Actions 相关文件&lt;/h3&gt;&lt;p&gt;在博客源码根目录创建 &lt;code&gt;.github/workflows/submit.yml&lt;/code&gt; 和 &lt;code&gt;.github/script/blog-update.sh&lt;/code&gt; 两个文件，填入下列代码。&lt;/p&gt;
&lt;p&gt;以下代码参考文章 &lt;a href=&#34;https://blog.kukmoon.com/f8bb4ee.html#23-%E7%BC%96%E5%86%99-workflow&#34;&gt;GitHub Actions 自动部署 Hexo 博客到 cPanel 虚拟主机 - 谷中望月&lt;/a&gt;，有所修改。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;submit.yml&lt;/code&gt;:&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;72&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs yaml&#34;&gt;&lt;span class=&#34;hljs-attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;CI&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# 监听 main 分支的改动与 Release 的发布&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-attr&#34;&gt;on:&lt;/span&gt;&lt;br&gt;  &lt;span class=&#34;hljs-attr&#34;&gt;push:&lt;/span&gt;&lt;br&gt;    &lt;span class=&#34;hljs-attr&#34;&gt;branches:&lt;/span&gt;&lt;br&gt;      &lt;span class=&#34;hljs-bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;main&lt;/span&gt;&lt;br&gt;  &lt;span class=&#34;hljs-attr&#34;&gt;release:&lt;/span&gt;&lt;br&gt;    &lt;span class=&#34;hljs-attr&#34;&gt;types:&lt;/span&gt; [&lt;span class=&#34;hljs-string&#34;&gt;published&lt;/span&gt;]&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-comment&#34;&gt;# 自定义环境变量&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-attr&#34;&gt;env:&lt;/span&gt;&lt;br&gt;  &lt;span class=&#34;hljs-attr&#34;&gt;GIT_USER:&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;Lao-Liu233&lt;/span&gt;  &lt;span class=&#34;hljs-comment&#34;&gt;# 改成你自己的 GitHub 用户名&lt;/span&gt;&lt;br&gt;  &lt;span class=&#34;hljs-attr&#34;&gt;GIT_EMAIL:&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;blog@udon.eu.org&lt;/span&gt;  &lt;span class=&#34;hljs-comment&#34;&gt;# 改成你自己的 GitHub 注册邮箱&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-attr&#34;&gt;jobs:&lt;/span&gt;&lt;br&gt;  &lt;span class=&#34;hljs-attr&#34;&gt;build:&lt;/span&gt;&lt;br&gt;    &lt;span class=&#34;hljs-attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;Build&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;on&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;$&amp;#123;&amp;#123;&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;matrix.node_version&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;#125;&amp;#125;&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;$&amp;#123;&amp;#123;&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;matrix.os&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;#125;&amp;#125;&lt;/span&gt;&lt;br&gt;    &lt;span class=&#34;hljs-attr&#34;&gt;runs-on:&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;ubuntu-latest&lt;/span&gt;&lt;br&gt;    &lt;span class=&#34;hljs-attr&#34;&gt;strategy:&lt;/span&gt;&lt;br&gt;      &lt;span class=&#34;hljs-attr&#34;&gt;matrix:&lt;/span&gt;&lt;br&gt;        &lt;span class=&#34;hljs-attr&#34;&gt;os:&lt;/span&gt; [&lt;span class=&#34;hljs-string&#34;&gt;ubuntu-latest&lt;/span&gt;]&lt;br&gt;        &lt;span class=&#34;hljs-attr&#34;&gt;node_version:&lt;/span&gt; [&lt;span class=&#34;hljs-number&#34;&gt;16.15&lt;/span&gt;]  &lt;span class=&#34;hljs-comment&#34;&gt;# 改成你本地的 Node.js 版本，可以用 `node --version` 命令查询&lt;/span&gt;&lt;br&gt;&lt;br&gt;    &lt;span class=&#34;hljs-attr&#34;&gt;steps:&lt;/span&gt;&lt;br&gt;      &lt;span class=&#34;hljs-comment&#34;&gt;# 获取博客源码&lt;/span&gt;&lt;br&gt;      &lt;span class=&#34;hljs-bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;hljs-attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;Checkout&lt;/span&gt;&lt;br&gt;        &lt;span class=&#34;hljs-attr&#34;&gt;uses:&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;actions/checkout@v2&lt;/span&gt;&lt;br&gt;      &lt;br&gt;      &lt;span class=&#34;hljs-comment&#34;&gt;# 用 Node.js 渲染&lt;/span&gt;&lt;br&gt;      &lt;span class=&#34;hljs-bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;hljs-attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;Use&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;Node.js&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;$&amp;#123;&amp;#123;&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;matrix.node_version&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;#125;&amp;#125;&lt;/span&gt;&lt;br&gt;        &lt;span class=&#34;hljs-attr&#34;&gt;uses:&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;actions/setup-node@v1&lt;/span&gt;&lt;br&gt;        &lt;span class=&#34;hljs-attr&#34;&gt;with:&lt;/span&gt;&lt;br&gt;          &lt;span class=&#34;hljs-attr&#34;&gt;node-version:&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;$&amp;#123;&amp;#123;&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;matrix.node_version&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;#125;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;br&gt;      &lt;span class=&#34;hljs-comment&#34;&gt;# 安装 Hexo-cli    &lt;/span&gt;&lt;br&gt;      &lt;span class=&#34;hljs-bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;hljs-attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;Install&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;hexo&lt;/span&gt;&lt;br&gt;        &lt;span class=&#34;hljs-attr&#34;&gt;run:&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;|&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;          npm install -g hexo-cli&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;&lt;/span&gt;&lt;br&gt;      &lt;span class=&#34;hljs-comment&#34;&gt;# 安装依赖&lt;/span&gt;&lt;br&gt;      &lt;span class=&#34;hljs-bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;hljs-attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;Install&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;dependencies&lt;/span&gt;    &lt;br&gt;        &lt;span class=&#34;hljs-attr&#34;&gt;run:&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;|&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;          npm install&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;&lt;/span&gt;&lt;br&gt;      &lt;span class=&#34;hljs-comment&#34;&gt;# 导入 submodule&lt;/span&gt;&lt;br&gt;      &lt;span class=&#34;hljs-bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;hljs-attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;Clone&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;submodule&lt;/span&gt;&lt;br&gt;        &lt;span class=&#34;hljs-attr&#34;&gt;run:&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;|&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;          git submodule update --init --recursive&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;&lt;/span&gt;&lt;br&gt;      &lt;span class=&#34;hljs-comment&#34;&gt;# 配置环境&lt;/span&gt;&lt;br&gt;      &lt;span class=&#34;hljs-comment&#34;&gt;# ssh-kenscan github.com &amp;gt;&amp;gt; ~/.ssh/known_hosts   # 从 GitHub 获取公钥并保存到 known_hosts 文件&lt;/span&gt;&lt;br&gt;      &lt;span class=&#34;hljs-bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;hljs-attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;Configuration&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;environment&lt;/span&gt;&lt;br&gt;        &lt;span class=&#34;hljs-attr&#34;&gt;run:&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;|&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;          sudo timedatectl set-timezone &amp;quot;Asia/Shanghai&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;          mkdir -p ~/.ssh/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;          echo &amp;quot;$HEXO_DEPLOY_PRI&amp;quot; &amp;gt; ~/.ssh/id_rsa&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;          chmod 600 ~/.ssh/id_rsa&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;          ssh-keyscan github.com &amp;gt;&amp;gt; ~/.ssh/known_hosts&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;          git config --global user.name $GIT_USER&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;          git config --global user.email $GIT_EMAIL&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;&lt;/span&gt;&lt;br&gt;      &lt;span class=&#34;hljs-comment&#34;&gt;# 生成并部署&lt;/span&gt;&lt;br&gt;      &lt;span class=&#34;hljs-bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;hljs-attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;Deploy&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;hexo&lt;/span&gt;&lt;br&gt;        &lt;span class=&#34;hljs-attr&#34;&gt;run:&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;|&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;          hexo clean&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;          hexo g -d&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-string&#34;&gt;&lt;/span&gt;&lt;br&gt;      &lt;span class=&#34;hljs-comment&#34;&gt;# 部署后更新博客源码，用于添加 abbrlink，如果不用 abbrlink，需要删除&lt;/span&gt;&lt;br&gt;      &lt;span class=&#34;hljs-bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;hljs-attr&#34;&gt;name:&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;Update&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;Blog&lt;/span&gt;&lt;br&gt;        &lt;span class=&#34;hljs-attr&#34;&gt;run:&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;|&lt;/span&gt;&lt;br&gt;          &lt;span class=&#34;hljs-string&#34;&gt;sh&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;$&amp;#123;GITHUB_WORKSPACE&amp;#125;/.github/script/blog-update.sh&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code&gt;.github/script/blog-update.sh&lt;/code&gt;:&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;code class=&#34;hljs bash&#34;&gt;&lt;span class=&#34;hljs-meta&#34;&gt;#!/bin/sh&lt;/span&gt;&lt;br&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;if&lt;/span&gt; [ -z &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;&lt;span class=&#34;hljs-subst&#34;&gt;$(git status --porcelain)&lt;/span&gt;&amp;quot;&lt;/span&gt; ]; &lt;span class=&#34;hljs-keyword&#34;&gt;then&lt;/span&gt;&lt;br&gt;    &lt;span class=&#34;hljs-built_in&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;nothing to update.&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;else&lt;/span&gt;&lt;br&gt;    git add &lt;span class=&#34;hljs-built_in&#34;&gt;source&lt;/span&gt;/_posts/	&lt;span class=&#34;hljs-comment&#34;&gt;#仅对文章源码所在文件夹进行修改&lt;/span&gt;&lt;br&gt;    git commit -m &lt;span class=&#34;hljs-string&#34;&gt;&amp;quot;triggle by commit &lt;span class=&#34;hljs-variable&#34;&gt;$&amp;#123;GITHUB_SHA&amp;#125;&lt;/span&gt;&amp;quot;&lt;/span&gt; -a&lt;br&gt;    git push origin main&lt;br&gt;&lt;span class=&#34;hljs-keyword&#34;&gt;fi&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;Commit + Push，打开 Actions 界面，就能看到正在运行的 Action 啦。&lt;/p&gt;
&lt;p&gt;不出意外，Action 成功执行，1分钟内博客就能渲染成功、部署至 GitHub Pages。&lt;/p&gt;
&lt;h2 id=&#34;同时部署至-CloudFlare-Pages&#34;&gt;&lt;a href=&#34;#同时部署至-CloudFlare-Pages&#34; class=&#34;headerlink&#34; title=&#34;同时部署至 CloudFlare Pages&#34;&gt;&lt;/a&gt;同时部署至 CloudFlare Pages&lt;/h2&gt;&lt;p&gt;步骤较为简单，我简述一下。&lt;/p&gt;
&lt;p&gt;打开 CloudFlare Pages， 连接至存放 &lt;strong&gt;渲染后&lt;/strong&gt; 的静态文件的仓库，渲染的框架选择 &lt;strong&gt;None&lt;/strong&gt;，执行的指令填写 &lt;code&gt;exit 0;&lt;/code&gt; 就可以了。&lt;/p&gt;
&lt;p&gt;执行部署后，渲染后的静态文件就被部署至 CloudFlare Pages 啦。&lt;/p&gt;
</content>
        <category term="教程" />
        <category term="GitHub Actions" />
        <category term="Hexo" />
        <updated>2022-05-23T11:30:00.000Z</updated>
    </entry>
</feed>
